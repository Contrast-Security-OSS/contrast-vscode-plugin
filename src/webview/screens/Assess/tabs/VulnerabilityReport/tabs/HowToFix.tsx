import React, { useEffect, useState } from 'react';
import {
  AssessVulnerability,
  VulnerabilityHowToFix,
} from '../../../../../../common/types';
import { renderContent } from '../../../../../utils/formattedText';

export function HowToFix({ vulnerability }: { vulnerability: unknown }) {
  const [howToFix, setHowToFix] = useState<VulnerabilityHowToFix | null>(null);

  useEffect(() => {
    if (vulnerability !== null && vulnerability !== undefined) {
      const data = vulnerability as AssessVulnerability;
      setHowToFix(data.howToFix as VulnerabilityHowToFix);
    }
  }, [vulnerability]);

  return (
    <div className="howToFix">
      <div
        className="text"
        dangerouslySetInnerHTML={{
          __html: renderContent(howToFix?.recommendation?.formattedText ?? ''),
        }}
      />
      <div className="text">{howToFix?.custom_recommendation?.text}</div>
      {howToFix?.cwe !== null &&
        howToFix?.cwe !== undefined &&
        howToFix?.cwe !== '' && (
          <div className="CWE">
            <div className="title">CWE</div>
            <div className="content">
              <a href={howToFix.cwe}>{howToFix.cwe}</a>
            </div>
          </div>
        )}
      {howToFix?.owasp !== null &&
        howToFix?.owasp !== undefined &&
        howToFix?.owasp !== '' && (
          <div className="OWASP">
            <div className="title">OWASP</div>
            <div className="content">
              <a href={howToFix.owasp}>{howToFix.owasp}</a>
            </div>
          </div>
        )}
      {howToFix?.rule_references?.text !== null &&
        howToFix?.rule_references?.text !== undefined &&
        howToFix?.rule_references?.text !== '' && (
          <div className="references">
            <div className="title">References</div>
            <div className="content">
              <a href={howToFix.rule_references?.text}>
                {howToFix.rule_references?.text}
              </a>
            </div>
          </div>
        )}

      {howToFix?.custom_rule_references?.text !== null &&
        howToFix?.custom_rule_references?.text !== undefined &&
        howToFix?.custom_rule_references?.text !== '' && (
          <div className="references">
            <div className="title">Custom References</div>
            <div className="content">
              <a href={howToFix.custom_rule_references?.text}>
                {howToFix.custom_rule_references?.text}
              </a>
            </div>
          </div>
        )}
    </div>
  );
}
